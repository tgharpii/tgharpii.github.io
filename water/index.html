<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar-nft.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/c-frame/aframe-extras@7.2.0/dist/aframe-extras.min.js"></script>
</head>

  <body>
    <a-scene 
      vr-mode-ui="enabled: false"
      arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: false;">
      
      <a-assets>
        <a-asset-item id="main" src="https://cdn.jsdelivr.net/gh/BlackSustainabilityNetwork/BSN@7a08ad34b6c8e7533c3b147bbb888996eca02db1/water/Assets/BSN_Water_Main.gltf"></a-asset-item>
        <a-asset-item id="CopyCube" src="https://cdn.jsdelivr.net/gh/BlackSustainabilityNetwork/BSN@7a08ad34b6c8e7533c3b147bbb888996eca02db1/water/Assets/BSN_Water_CopyCube.gltf"></a-asset-item>
        <a-asset-item id="joinButton" src="https://cdn.jsdelivr.net/gh/BlackSustainabilityNetwork/BSN@7a08ad34b6c8e7533c3b147bbb888996eca02db1/water/Assets/joinButton.gltf"></a-asset-item>
        <a-asset-item id="nextButton" src="https://cdn.jsdelivr.net/gh/BlackSustainabilityNetwork/BSN@7a08ad34b6c8e7533c3b147bbb888996eca02db1/water/Assets/nextButton.gltf"></a-asset-item>
        <a-asset-item id="findButton" src="https://cdn.jsdelivr.net/gh/BlackSustainabilityNetwork/BSN@7a08ad34b6c8e7533c3b147bbb888996eca02db1/water/Assets/findButton.gltf"></a-asset-item>
        <a-asset-item id="WaterBarrel" src="https://cdn.jsdelivr.net/gh/BlackSustainabilityNetwork/BSN@7a08ad34b6c8e7533c3b147bbb888996eca02db1/water/Assets/BSN_Water_WaterBarrel.gltf"></a-asset-item>

      </a-assets>

      <a-camera rotation-reader position="0 0 0" look-controls raycaster="objects: .clickable" cursor="rayOrigin: mouse;"></a-camera>

      <a-entity>
        <a-gltf-model 
          id="mainEntity"
          rotation="0 0 0" 
          position="0 -15 -35" 
          scale="0 0 0" 
          src="#main"
          animation-mixer="clip: FarmerMove; loop: true; true; timeScale:1;"
          animation__fadein="property: scale; to: 1 1 1; dur: 1000; easing: easeOutCubic; startEvents: model-loaded">
        </a-gltf-model>

        <a-gltf-model 
          id="CopyCubeEntity"
          rotation="0 0 0" 
          position="9 -11 -30.5" 
          scale="0 0 0" 
          src="#CopyCube"
          animation__fadein="property: scale; to: 1 1 1; dur: 1000; easing: easeOutCubic; startEvents: model-loaded">
        </a-gltf-model>

        <a-gltf-model
          id="WaterBarrelEntity"
          rotation="0 0 0"
          position="0 -15 -35"
          scale="0 0 0"
          src="#WaterBarrel"
          animation-mixer="clip: WaterIncrease; loop: true; timeScale:1"
          animation__fadein="property: scale; to: 1 1 1; dur: 1000; easing: easeOutCubic; startEvents: model-loaded">
        </a-gltf-model>

        <a-gltf-model 
          id="NextButtonEntity"
          class="clickable"
          rotation="0 0 0" 
          position="-13.75 -10 -14" 
          scale="0 0 0" 
          src="#nextButton"
          animation__fadein="property: scale; to: 1 1 1; dur: 1000; easing: easeOutCubic; startEvents: model-loaded">
        </a-gltf-model>

        <a-gltf-model 
          id="joinButtonEntity"
          class="clickable"
          rotation="0 0 0" 
          position="-19 -13 -14" 
          scale="0 0 0" 
          src="#joinButton"
          animation__fadein="property: scale; to: 1 1 1; dur: 1000; easing: easeOutCubic; startEvents: model-loaded">
        </a-gltf-model>

        <a-gltf-model 
          id="FindButtonEntity"
          class="clickable"
          rotation="0 0 0" 
          position="-34 -13 -14" 
          scale="0 0 0" 
          src="#findButton"
          animation__fadein="property: scale; to: 1 1 1; dur: 1000; easing: easeOutCubic; startEvents: model-loaded">
        </a-gltf-model>

      </a-entity>
    </a-scene>

    <script>
      // Wait for scene to load before attaching listener
      document.addEventListener('DOMContentLoaded', () => {
        const CopyCubeEntity = document.querySelector('#CopyCubeEntity');  // Reference to the avatar model
        const joinButtonEntity = document.querySelector('#joinButtonEntity');
        const nextButtonEntity = document.querySelector('#NextButtonEntity');
        const FindButtonEntity = document.querySelector('#FindButtonEntity');
        const FarmerStatEntity = document.querySelector('#FarmerStatEntity');

        const animations = ['CopyCubeLoop', 'CopyCube1', 'CopyCube2', 'CopyCube3'];
        let currentClipIndex = 0;

        CopyCubeEntity.setAttribute('animation-mixer', `clip: ${animations[currentClipIndex]}; loop: once; timeScale: 1; clampWhenFinished: true;`);

        nextButtonEntity.addEventListener('click', () => {
          // Move to the next animation
          currentClipIndex = (currentClipIndex + 1) % animations.length;
          const currentClip = animations[currentClipIndex];

          // Set the new animation-mixer with clampWhenFinished: true
          CopyCubeEntity.setAttribute('animation-mixer', `clip: ${currentClip}; loop: once; clampWhenFinished: True; timeScale: 1;`);

        });

      
        joinButtonEntity.addEventListener('click', () => {
            window.open("https://www.blacksustainability.org/join-our-network", "_blank");
        });

        FindButtonEntity.addEventListener('click', () => {
            window.open("https://maps.blacksustainability.org/", "_blank");
        });
      });

    </script>
  </body>
</html>
